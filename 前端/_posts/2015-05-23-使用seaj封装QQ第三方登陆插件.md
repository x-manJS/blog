---
layout: post
title: 使用seaj封装QQ第三方登陆功能
tags:QQ登陆 seajs
---

今天根据网络上的QQ JS-SDK第三方登陆教程，把登陆的功能用seajs封装起来，以方便将来复用。目前功能比较简单，只有一个登陆后的回调。以后有空再加写功能。本来是想加获取用户信息的功能的，但是没权限，没法验证正确性，所以就先等等在说了。

首先，依赖有：

	seajs
	jquery

首先贴一下seajs封装的代码：

	define(function(require) {
		require('Handlebars');
		require('http://tjs.sjs.sinajs.cn/open/api/js/wb.js?appkey=TUq5hiDKEcZwpRlb');
		require('http://qzonestyle.gtimg.cn/qzone/openapi/qc.js#appId=1104631716');
		require('jquery');
	
		var QQLogin = function(options) {
			if (!options || !options.qqLoginBtnPanelEl)
				throw Error('qqLoginBtnPanelEl');
			this.options = options;
			this.afterLogin = options.afterLogin;
		}
		QQLogin.prototype = {
			init: function() {
				this.loadingQQLoginButton();
				this._bindBtn();
				this.loginCallBack();
			},
			loadingQQLoginButton: function() {
				var loginButton = '<span id="qq_login_btn"></span>';
				var panel = $(this.options.qqLoginBtnPanelEl);
				if (!panel || panel.length == 0)
					throw Error('qqLoginBtnPanelEl无效');
				panel.append(loginButton);
			},
			_bindBtn: function() {
				QC.Login({
					btnId: "qq_login_btn",
					size: "A_XL",
					scope: "all",
					display: "pc"
				});
			},
			hasRequestQQ: false,
			loginCallBack: function(callback) {
				if (this.hasRequestQQ) return;
				var that = this;
				QC.Login.getMe(function(openId, accessToken) {
					that.options.afterLogin(openId, accessToken, '第一个参数是openId，第二个是AccessToken');
				});
				this.hasRequestQQ = true;
			},
			afterLogin: function(){
	
			}
		};
		return QQLogin;
	})


使用代码示例：

	define(function (require) {
	    var QQLogin = require('qq-login');
	    var qqLogin = new QQLogin({
	            qqLoginBtnPanelEl: '#QQloginpanel',
	            afterLogin: function(a,b){
	            	console.log(a,b);
	            }
	    });
	    qqLogin.init();
	});

传入的参数，
	{
	    qqLoginBtnPanelEl: '#QQloginpanel',
	    afterLogin: function(a,b){
	    	console.log(a,b);
    }

qqLoginBtnPanelEl是必须的，表示登陆按钮要放在哪里。
afterLogin是登陆后的回调函数，a和b一个是openid，一个是AccessToken。

