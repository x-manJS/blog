---
layout: post
title: 树莓派下安装MongoDB
tags: 树莓派 linux mongodb mongo
---

昨天装好了node，需要个mongodb数据。

在官网下载的文件在树莓派在中无法使用，报错：

	Syntax error: word unexpected (expecting ")") 。



然后按照[http://c-mobberley.com/wordpress/index.php/2013/10/14/raspberry-pi-mongodb-installation-the-working-guide/](http://c-mobberley.com/wordpress/index.php/2013/10/14/raspberry-pi-mongodb-installation-the-working-guide/)的教程来做了一遍。

让我们开始安装，首先在树莓派中打开terminal，然后运行下面的指令：

	sudo apt-get update
	sudo apt-get upgrade -f


接下来安装写库：
	
	sudo apt-get install build-essential libboost-filesystem-dev libboost-program-options-dev libboost-system-dev libboost-thread-dev scons libboost-all-dev python-pymongo git



然后用git获取源码：
	
	cd ~
	
	git clone https://github.com/skrabban/mongo-nonx86

源码中包含一个叫mongo-nonx86的文件夹，进入：

	cd mongo-nonx86

现在我们有一个未编译的mongodb版本，我们将在树莓派上编译mongodb。要确保你的树莓派的SD卡空间有500M的可使用空间。

然后执行下面的指令：

	sudo scons

这个指令会花费数小时的时间，最好让它通宵跑着。上面的指令会为我们编译仓库。

我执行指令`scons`没有使用`sudo`,导致了错误，执行`sudo scons`一切正常.

现在我们可以执行：

	sudo scons --prefix=/opt/mongo install

在一次执行上面的代码会花费数小时的时间，我共花了4个小时，你应该有个在树莓派上的mongo的安装。

现在我们需要做些文件的创建和权限授予的工作，完成后 `init.d`里的脚本可以简单的开始mongodb了。

#### 授予用户和用户组权限

	sudo adduser --firstuid 100 --ingroup nogroup --shell /etc/false --disabled-password --gecos "" --no-create-home mongodb

执行

	adduser -help

或者

	man adduser

--firstuid 100 我的理解是，本来是随机给一个uid的，但是这边指定了100代替了随机给的uid。

查看各个参数的作用。


#### 为我们的日志文件创建文件夹

	sudo mkdir /var/log/mongodb/

#### 授权给日志文件
	
	sudo chown mongodb:nogroup /var/log/mongodb

#### 为我们的数据创建目录

	sudo mkdir /var/lib/mongodb

#### 为数据目录创建权限

	sudo chown mongodb:nogroup /var/lib/mongodb

#### 复制我们的init.d文件到exc中

	sudo cp debian/init.d  /etc/init.d/mongod

#### 复制我们的配置文件到exc

	sudo cp debian/mongodb.conf /etc/

#### 创建mongod的软连接

	sudo ln /opt/mongo/bin/mongod /usr/bin/mongod


最后的几步要完成，这些没做的话，当运行init.d脚本时会出现些问题。

	sudo chmod u+x /etc/init.d/mongod

	sudo update-rc.d mongod defaults


当执行上面的代码是，你可能会遇到一些警告，你可以忽略。

现在我们可以启动mongodb了，执行：

	sudo /etc/init.d/mongod start


Enjoy!
	