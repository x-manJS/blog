---
layout: post
title: 泛型的类型转换
tags: 泛型 类型转换
---

接上篇的《WebApi的ModelBinder 实现自定义参数类型》，有这样的一种情况，就是要把字符串转换为某种类型，这种类型可能是int，可能是double，也有可能是其他各种，也就是说这边是个T，要怎么类型转换呢？（求更好的描述这句话）。

看代码描述：

	 public class ListModelBinder<T> : IModelBinder
    {
        public bool BindModel(System.Web.Http.Controllers.HttpActionContext actionContext, ModelBindingContext bindingContext)
        {
            ValueProviderResult result = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);

            string[] valueList = result.AttemptedValue.Split(',');

            List<T> list = new List<T>();

            foreach (string value in valueList)
            {
				// 这里要怎么把这个string转换成T呢
            }

            bindingContext.Model = list;
            return true;
        }
    }


这么转换， （`- -|`其实这是篇笔记）

有个`TypeDescriptor`对象.

调用GetConverter方法，获取一个TypeConverter对象：

	TypeConverter converter = TypeDescriptor.GetConverter(typeof(T))

然后进行转换：

	string value = "12";
	T newVlaue = (T)converter.Convert(value);

上面有个强制转换的过程，这样就完成了。

然后贴上全部代码：

	public class ListModelBinder<T> : IModelBinder
    {
        public bool BindModel(System.Web.Http.Controllers.HttpActionContext actionContext, ModelBindingContext bindingContext)
        {
            ValueProviderResult result = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);

            string[] valueList = result.AttemptedValue.Split(',');

            TypeConverter converter = TypeDescriptor.GetConverter(typeof(T));
            List<T> list = new List<T>();

            foreach (string value in valueList)
            {
               T newValue = (T)converter.ConvertFromString(value);
               list.Add(newValue);
            }

            bindingContext.Model = list;
            return true;
        }
    }
	