---
layout: post
title: C#开源日志组件log4net
tags: log4net
---

下载了个开源项目，发现很眼熟的log4net.dll，于是来看看log4net是如何使用的。

主页： [http://logging.apache.org/log4net/](http://logging.apache.org/log4net/)

github: [https://github.com/apache/log4net](https://github.com/apache/log4net)

Apache log4net库是一个帮助程序员输出日志的工具。


使用dll，用nuget搜索log4net并安装。


Log4net主要是配置相关的配置。

### 在Web.config中添加节点
---

添加`configSections`子节点

	<configSections>
		<section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler,log4net" />
	</configSections>


section节点属性：

name：必选的 String 属性，指定与 type 属性中指定的配置节处理程序关联的配置节或元素的名称。这是该元素在配置文件的节设置区域中使用的名称。

type：必选的 String 属性，指定用来执行如下操作的配置节处理程序类的名称：处理在 name 属性中指定的节或元素中的配置设置。

### 创建log4net.config文件
---

	<?xml version="1.0" encoding="utf-8" ?>
	<configuration>
	  <log4net>
	    <!-- 信息日志类 -->
	    <logger name="loginfo">
	      <level value="ALL" />
	      <appender-ref ref="InfoAppender" />
	    </logger>
	
	    <!-- 信息日志附加介质 -->
	    <appender name="InfoAppender" type="log4net.Appender.RollingFileAppender">
	      <!-- 输出到什么目录 -->
	      <param name="File" value="Log\\LogInfo\\" />
	      <!-- 是否覆写到文件中 -->
	      <param name="AppendToFile" value="true" />
	      <!-- 备份文件的个数 -->
	      <param name="MaxSizeRollBackups" value="50" />
	      <!-- 单个日志文件最大的大小 -->
	      <param name="MaxFileSize" value="10240" />
	      <!-- 是否使用静态文件名 -->
	      <param name="StaticLogFileName" value="false" />
	      <!-- 日志文件名 -->
	      <param name="DatePattern" value="yyyyMMdd&quot;.htm&quot;" />
	      <param name="RollingStyle" value="Date" />
	      <!-- 布局，更多参数可参照官网说明 -->
	      <layout type="log4net.Layout.PatternLayout">
	        <param name="ConversionPattern" value="&lt;HR COLOR=red&gt;
	          %n级别：%-5p &lt;BR&gt;
	          %n时间：%d [%t] &lt;BR&gt;
	          %n描述：%m &lt;BR&gt;"/>
	      </layout>
	    </appender>
	  </log4net>
	</configuration>


这些都是些重要的配置。



### 关联log4net.config到程序
---

`log4net.confi`毕竟是新建的config文件，要关联到程序，需要在`AssemblyInfo.cs`文件中添加关联配置,在文件的最后加一行：

	[assembly: log4net.Config.XmlConfigurator(ConfigFile = "log4net.config", ConfigFileExtension = "config", Watch = true)]

或者在`APP_Star`的`Register`中添加：

	log4net.Config.XmlConfigurator.Configure(new System.IO.FileInfo(HostingEnvironment.MapPath("~/log4net.config")));

也是可以的。

### 使用的示例
---

现在写代码，

	string logModel = "loginfo";
	ILog log = LogManager.GetLogger(logModel);
	
	if(log.IsInfoEnabled)
	{
		log.Info("Hi log4net");	
	}



这里的logModel是`log4net.config`配置文件中的

	 <logger name="loginfo">
	      <level value="ALL" />
	      <appender-ref ref="InfoAppender" />
	 </logger>


这个name的值"loginfo"。真实使用时可以进一步封装。

就酱。

	
	

